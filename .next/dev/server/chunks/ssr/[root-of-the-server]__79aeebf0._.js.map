{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tomul/Desktop/fm-proto/app/app/configurator/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useMemo, useState } from \"react\";\r\n\r\ntype StyleKey = \"tokyo\" | \"anime\" | \"simpsons\" | \"pixar\" | \"gta\";\r\n\r\nconst STYLES: Record<StyleKey, string> = {\r\n  simpsons: \"Simpsons-style cartoon portrait, flat colors, thick outlines.\",\r\n  anime: \"Anime portrait, clean lineart, vibrant colors.\",\r\n  tokyo: \"Tokyo Revengers-style anime portrait, dramatic lighting.\",\r\n  pixar: \"3D animated film look, soft lighting, detailed shading (Pixar-like).\",\r\n  gta: \"GTA V / Rockstar illustration style, sharp outlines, high contrast, cinematic lighting, poster-like composition.\",\r\n};\r\n\r\n\r\ntype DraftOrder = {\r\n  draftOrderId: string;\r\n  createdAt: number;\r\n  style: StyleKey;\r\n  originalFileName: string;\r\n  generatedImageUrl: string;\r\n  generatedImageId?: string;\r\n};\r\n\r\nfunction makeDraftId() {\r\n  // jednoduchý id generator pro prototyp\r\n  return `draft_${Date.now()}_${Math.random().toString(16).slice(2)}`;\r\n}\r\n\r\nexport default function Home() {\r\n  const [file, setFile] = useState<File | null>(null);\r\n  const [style, setStyle] = useState<StyleKey>(\"tokyo\");\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const [imgSrc, setImgSrc] = useState<string | null>(null);\r\n  const [savedUrl, setSavedUrl] = useState<string | null>(null);\r\n  const [draft, setDraft] = useState<DraftOrder | null>(null);\r\n\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const [customPrompt, setCustomPrompt] = useState(\"\");\r\n\r\n\r\n  const previewUrl = useMemo(() => (file ? URL.createObjectURL(file) : null), [file]);\r\n\r\nasync function generate() {\r\n  setLoading(true);\r\n  setError(null);\r\n  setImgSrc(null);\r\n  setSavedUrl(null);\r\n  setDraft(null);\r\n\r\n  try {\r\n    if (!file) throw new Error(\"Nahraj fotku.\");\r\n\r\n    const fd = new FormData();\r\n    fd.append(\"file\", file);\r\n    fd.append(\"style\", style);\r\n    fd.append(\"customPrompt\", customPrompt);\r\n\r\n    const res = await fetch(\"/api/transform-gemini\", {\r\n      method: \"POST\",\r\n      body: fd,\r\n    });\r\n\r\n    const data = await res.json();\r\n    if (!res.ok) throw new Error(data?.error || \"Request failed\");\r\n\r\n    // ✅ uděláme si finální URL, které bude fungovat i v Shopify (absolutní)\r\n    let finalUrl: string | null = null;\r\n\r\n    if (data.url) {\r\n      finalUrl = new URL(data.url, window.location.origin).toString();\r\n      setImgSrc(finalUrl);\r\n      setSavedUrl(finalUrl);\r\n\r\n      // ✅ pošli zprávu do Shopify (parent okno)\r\n      const isShopify = new URLSearchParams(window.location.search).get(\"shopify\") === \"1\";\r\n      const designId =\r\n        (typeof data.id === \"string\" && data.id) ||\r\n        (finalUrl.split(\"/\").pop() ?? String(Date.now()));\r\n\r\n      if (isShopify && window.parent && window.parent !== window) {\r\n        window.parent.postMessage(\r\n          { type: \"FM_DESIGN_READY\", designUrl: finalUrl, designId },\r\n          \"*\"\r\n        );\r\n        console.log(\"[FM] sent FM_DESIGN_READY\", { finalUrl, designId });\r\n      }\r\n    } else if (data.b64) {\r\n      // fallback: base64 preview (tohle do Shopify overlay nedávej, proto neposíláme postMessage)\r\n      setImgSrc(`data:${data.mime || \"image/png\"};base64,${data.b64}`);\r\n    } else {\r\n      throw new Error(\"No image returned\");\r\n    }\r\n\r\n    // 2) simulace objednávky = uložit draft do localStorage\r\n    const draftOrder: DraftOrder = {\r\n      draftOrderId: makeDraftId(),\r\n      createdAt: Date.now(),\r\n      style,\r\n      originalFileName: file.name,\r\n      generatedImageUrl: finalUrl || \"\",\r\n      generatedImageId: data.id,\r\n    };\r\n\r\n    localStorage.setItem(\"fm_draft_order\", JSON.stringify(draftOrder));\r\n    setDraft(draftOrder);\r\n  } catch (e: any) {\r\n    setError(e?.message ?? String(e));\r\n  } finally {\r\n    setLoading(false);\r\n  }\r\n}\r\n\r\n\r\n  function loadDraft() {\r\n    setError(null);\r\n    try {\r\n      const raw = localStorage.getItem(\"fm_draft_order\");\r\n      if (!raw) {\r\n        setDraft(null);\r\n        setSavedUrl(null);\r\n        return;\r\n      }\r\n      const parsed = JSON.parse(raw) as DraftOrder;\r\n      setDraft(parsed);\r\n      setSavedUrl(parsed.generatedImageUrl || null);\r\n    } catch (e: any) {\r\n      setError(e?.message ?? String(e));\r\n    }\r\n  }\r\n\r\n  function clearDraft() {\r\n    localStorage.removeItem(\"fm_draft_order\");\r\n    setDraft(null);\r\n    setSavedUrl(null);\r\n  }\r\n\r\n  return (\r\n    <main style={{ padding: 24, fontFamily: \"system-ui, sans-serif\" }}>\r\n      <h1 style={{ fontSize: 24, fontWeight: 700 }}>FM Proto – photo → style</h1>\r\n\r\n      <div style={{ marginTop: 16, display: \"flex\", gap: 16, alignItems: \"center\", flexWrap: \"wrap\" }}>\r\n        <input\r\n          type=\"file\"\r\n          accept=\"image/*\"\r\n          onChange={(e) => setFile(e.target.files?.[0] ?? null)}\r\n        />\r\n\r\n        <select value={style} onChange={(e) => setStyle(e.target.value as StyleKey)}>\r\n          <option value=\"tokyo\">Tokyo Revengers</option>\r\n          <option value=\"anime\">Anime</option>\r\n          <option value=\"simpsons\">Simpsons</option>\r\n          <option value=\"pixar\">3D film look</option>\r\n          <option value=\"gta\">GTA (Rockstar poster)</option>\r\n\r\n        </select>\r\n\r\n        <div style={{ marginTop: 12 }}>\r\n          <div style={{ marginBottom: 6, opacity: 0.8 }}>Custom prompt (volitelné):</div>\r\n          <input\r\n            value={customPrompt}\r\n            onChange={(e) => setCustomPrompt(e.target.value)}\r\n            placeholder='např. \"make background neon city, add subtle grain\"'\r\n            style={{ width: \"100%\", maxWidth: 640, padding: 10 }}\r\n          />\r\n        </div>\r\n\r\n\r\n        <button onClick={generate} disabled={loading} style={{ padding: \"10px 14px\" }}>\r\n          {loading ? \"Generating...\" : \"Generate\"}\r\n        </button>\r\n\r\n        <button onClick={loadDraft} style={{ padding: \"10px 14px\" }}>\r\n          Load saved draft\r\n        </button>\r\n\r\n        <button onClick={clearDraft} style={{ padding: \"10px 14px\" }}>\r\n          Clear draft\r\n        </button>\r\n      </div>\r\n\r\n      {previewUrl && (\r\n        <div style={{ marginTop: 16 }}>\r\n          <div style={{ marginBottom: 8, opacity: 0.8 }}>Original preview:</div>\r\n          <img src={previewUrl} alt=\"Original\" style={{ width: 256, borderRadius: 10 }} />\r\n        </div>\r\n      )}\r\n\r\n      {error && <p style={{ color: \"red\", marginTop: 12 }}>{error}</p>}\r\n\r\n      {imgSrc && (\r\n        <div style={{ marginTop: 16 }}>\r\n          <div style={{ marginBottom: 8, opacity: 0.8 }}>Generated:</div>\r\n          <img src={imgSrc} alt=\"Generated\" style={{ width: 512, borderRadius: 10 }} />\r\n        </div>\r\n      )}\r\n\r\n      {(draft || savedUrl) && (\r\n        <div style={{ marginTop: 20, padding: 12, border: \"1px solid #333\", borderRadius: 10 }}>\r\n          <div style={{ fontWeight: 700, marginBottom: 8 }}>Order draft (simulace)</div>\r\n\r\n          {draft ? (\r\n            <>\r\n              <div><b>draftOrderId:</b> {draft.draftOrderId}</div>\r\n              <div><b>style:</b> {draft.style}</div>\r\n              <div><b>originalFileName:</b> {draft.originalFileName}</div>\r\n              <div><b>generatedImageId:</b> {draft.generatedImageId ?? \"-\"}</div>\r\n              <div style={{ marginTop: 8 }}>\r\n                <b>generatedImageUrl:</b>{\" \"}\r\n                <a href={draft.generatedImageUrl} target=\"_blank\" rel=\"noreferrer\">\r\n                  {draft.generatedImageUrl}\r\n                </a>\r\n              </div>\r\n            </>\r\n          ) : (\r\n            <div style={{ opacity: 0.8 }}>\r\n              Draft není v paměti komponenty, ale URL je uložená:{\" \"}\r\n              <a href={savedUrl ?? \"\"} target=\"_blank\" rel=\"noreferrer\">\r\n                {savedUrl}\r\n              </a>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 523, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tomul/Desktop/fm-proto/app/node_modules/next/src/server/route-modules/app-page/module.compiled.js"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK"],"mappings":"AAAA,IAAIA,QAAQC,GAAG,CAACC,YAAY,KAAK,QAAQ;;KAElC;IACL,IAAIF,QAAQC,GAAG,CAACK,yBAAyB,EAAE;;SAcpC;QACL,IAAIN,QAAQC,GAAG,CAACM,QAAQ,KAAK,WAAe;YAC1C,IAAIP,QAAQC,GAAG,CAACO,SAAS,eAAE;gBACzBL,OAAOC,OAAO,GAAGC,QAAQ;YAC3B,OAAO;;QAGT,OAAO;;IAOT;AACF","ignoreList":[0]}},
    {"offset": {"line": 542, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tomul/Desktop/fm-proto/app/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxDevRuntime\n"],"names":["module","exports","require","vendored","ReactJsxDevRuntime"],"mappings":"AAAAA,OAAOC,OAAO,GACZC,QAAQ,4HACRC,QAAQ,CAAC,YAAY,CAAEC,kBAAkB","ignoreList":[0]}},
    {"offset": {"line": 547, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tomul/Desktop/fm-proto/app/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n"],"names":["module","exports","require","vendored","React"],"mappings":"AAAAA,OAAOC,OAAO,GACZC,QAAQ,4HACRC,QAAQ,CAAC,YAAY,CAAEC,KAAK","ignoreList":[0]}}]
}