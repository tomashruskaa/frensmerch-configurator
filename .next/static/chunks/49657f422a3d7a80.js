(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,39754,e=>{"use strict";var t=e.i(43476),r=e.i(71645);function n(){let[e,n]=(0,r.useState)(null),[i,l]=(0,r.useState)("tokyo"),[a,s]=(0,r.useState)(!1),[o,d]=(0,r.useState)(null),[c,g]=(0,r.useState)(null),[p,m]=(0,r.useState)(null),[u,h]=(0,r.useState)(null),[x,f]=(0,r.useState)(""),y=(0,r.useMemo)(()=>e?URL.createObjectURL(e):null,[e]);async function j(){s(!0),h(null),d(null),g(null),m(null);try{if(!e)throw Error("Nahraj fotku.");let t=new FormData;t.append("file",e),t.append("style",i),t.append("customPrompt",x);let r=await fetch("/api/transform-gemini",{method:"POST",body:t}),n=await r.json();if(!r.ok)throw Error(n?.error||"Request failed");let l=null;if(n.url){l=new URL(n.url,window.location.origin).toString(),d(l),g(l);let e="1"===new URLSearchParams(window.location.search).get("shopify"),t="string"==typeof n.id&&n.id||(l.split("/").pop()??String(Date.now()));e&&window.parent&&window.parent!==window&&(window.parent.postMessage({type:"FM_DESIGN_READY",designUrl:l,designId:t},"*"),console.log("[FM] sent FM_DESIGN_READY",{finalUrl:l,designId:t}))}else if(n.b64)d(`data:${n.mime||"image/png"};base64,${n.b64}`);else throw Error("No image returned");let a={draftOrderId:`draft_${Date.now()}_${Math.random().toString(16).slice(2)}`,createdAt:Date.now(),style:i,originalFileName:e.name,generatedImageUrl:l||"",generatedImageId:n.id};localStorage.setItem("fm_draft_order",JSON.stringify(a)),m(a)}catch(e){h(e?.message??String(e))}finally{s(!1)}}return(0,t.jsxs)("main",{style:{padding:24,fontFamily:"system-ui, sans-serif"},children:[(0,t.jsx)("h1",{style:{fontSize:24,fontWeight:700},children:"FM Proto – photo → style"}),(0,t.jsxs)("div",{style:{marginTop:16,display:"flex",gap:16,alignItems:"center",flexWrap:"wrap"},children:[(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:e=>n(e.target.files?.[0]??null)}),(0,t.jsxs)("select",{value:i,onChange:e=>l(e.target.value),children:[(0,t.jsx)("option",{value:"tokyo",children:"Tokyo Revengers"}),(0,t.jsx)("option",{value:"anime",children:"Anime"}),(0,t.jsx)("option",{value:"simpsons",children:"Simpsons"}),(0,t.jsx)("option",{value:"pixar",children:"3D film look"}),(0,t.jsx)("option",{value:"gta",children:"GTA (Rockstar poster)"})]}),(0,t.jsxs)("div",{style:{marginTop:12},children:[(0,t.jsx)("div",{style:{marginBottom:6,opacity:.8},children:"Custom prompt (volitelné):"}),(0,t.jsx)("input",{value:x,onChange:e=>f(e.target.value),placeholder:'např. "make background neon city, add subtle grain"',style:{width:"100%",maxWidth:640,padding:10}})]}),(0,t.jsx)("button",{onClick:j,disabled:a,style:{padding:"10px 14px"},children:a?"Generating...":"Generate"}),(0,t.jsx)("button",{onClick:function(){h(null);try{let e=localStorage.getItem("fm_draft_order");if(!e){m(null),g(null);return}let t=JSON.parse(e);m(t),g(t.generatedImageUrl||null)}catch(e){h(e?.message??String(e))}},style:{padding:"10px 14px"},children:"Load saved draft"}),(0,t.jsx)("button",{onClick:function(){localStorage.removeItem("fm_draft_order"),m(null),g(null)},style:{padding:"10px 14px"},children:"Clear draft"})]}),y&&(0,t.jsxs)("div",{style:{marginTop:16},children:[(0,t.jsx)("div",{style:{marginBottom:8,opacity:.8},children:"Original preview:"}),(0,t.jsx)("img",{src:y,alt:"Original",style:{width:256,borderRadius:10}})]}),u&&(0,t.jsx)("p",{style:{color:"red",marginTop:12},children:u}),o&&(0,t.jsxs)("div",{style:{marginTop:16},children:[(0,t.jsx)("div",{style:{marginBottom:8,opacity:.8},children:"Generated:"}),(0,t.jsx)("img",{src:o,alt:"Generated",style:{width:512,borderRadius:10}})]}),(p||c)&&(0,t.jsxs)("div",{style:{marginTop:20,padding:12,border:"1px solid #333",borderRadius:10},children:[(0,t.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Order draft (simulace)"}),p?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("b",{children:"draftOrderId:"})," ",p.draftOrderId]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("b",{children:"style:"})," ",p.style]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("b",{children:"originalFileName:"})," ",p.originalFileName]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("b",{children:"generatedImageId:"})," ",p.generatedImageId??"-"]}),(0,t.jsxs)("div",{style:{marginTop:8},children:[(0,t.jsx)("b",{children:"generatedImageUrl:"})," ",(0,t.jsx)("a",{href:p.generatedImageUrl,target:"_blank",rel:"noreferrer",children:p.generatedImageUrl})]})]}):(0,t.jsxs)("div",{style:{opacity:.8},children:["Draft není v paměti komponenty, ale URL je uložená:"," ",(0,t.jsx)("a",{href:c??"",target:"_blank",rel:"noreferrer",children:c})]})]})]})}e.s(["default",()=>n])}]);