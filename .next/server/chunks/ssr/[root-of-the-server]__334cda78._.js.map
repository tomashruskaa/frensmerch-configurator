{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/module.compiled.js","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","../../../../app/configurator/page.tsx"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","\"use client\";\r\nimport { useMemo, useState } from \"react\";\r\n\r\ntype StyleKey = \"tokyo\" | \"anime\" | \"simpsons\" | \"pixar\" | \"gta\";\r\n\r\nconst STYLES: Record<StyleKey, string> = {\r\n  simpsons: \"Simpsons-style cartoon portrait, flat colors, thick outlines.\",\r\n  anime: \"Anime portrait, clean lineart, vibrant colors.\",\r\n  tokyo: \"Tokyo Revengers-style anime portrait, dramatic lighting.\",\r\n  pixar: \"3D animated film look, soft lighting, detailed shading (Pixar-like).\",\r\n  gta: \"GTA V / Rockstar illustration style, sharp outlines, high contrast, cinematic lighting, poster-like composition.\",\r\n};\r\n\r\n\r\ntype DraftOrder = {\r\n  draftOrderId: string;\r\n  createdAt: number;\r\n  style: StyleKey;\r\n  originalFileName: string;\r\n  generatedImageUrl: string;\r\n  generatedImageId?: string;\r\n};\r\n\r\nfunction makeDraftId() {\r\n  // jednoduchý id generator pro prototyp\r\n  return `draft_${Date.now()}_${Math.random().toString(16).slice(2)}`;\r\n}\r\n\r\nexport default function Home() {\r\n  const [file, setFile] = useState<File | null>(null);\r\n  const [style, setStyle] = useState<StyleKey>(\"tokyo\");\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const [imgSrc, setImgSrc] = useState<string | null>(null);\r\n  const [savedUrl, setSavedUrl] = useState<string | null>(null);\r\n  const [draft, setDraft] = useState<DraftOrder | null>(null);\r\n\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const [customPrompt, setCustomPrompt] = useState(\"\");\r\n\r\n\r\n  const previewUrl = useMemo(() => (file ? URL.createObjectURL(file) : null), [file]);\r\n\r\nasync function generate() {\r\n  setLoading(true);\r\n  setError(null);\r\n  setImgSrc(null);\r\n  setSavedUrl(null);\r\n  setDraft(null);\r\n\r\n  try {\r\n    if (!file) throw new Error(\"Nahraj fotku.\");\r\n\r\n    const fd = new FormData();\r\n    fd.append(\"file\", file);\r\n    fd.append(\"style\", style);\r\n    fd.append(\"customPrompt\", customPrompt);\r\n\r\n    const res = await fetch(\"/api/transform-gemini\", {\r\n      method: \"POST\",\r\n      body: fd,\r\n    });\r\n\r\n    const data = await res.json();\r\n    if (!res.ok) throw new Error(data?.error || \"Request failed\");\r\n\r\n    // ✅ uděláme si finální URL, které bude fungovat i v Shopify (absolutní)\r\n    let finalUrl: string | null = null;\r\n\r\n    if (data.url) {\r\n      finalUrl = new URL(data.url, window.location.origin).toString();\r\n      setImgSrc(finalUrl);\r\n      setSavedUrl(finalUrl);\r\n\r\n      // ✅ pošli zprávu do Shopify (parent okno)\r\n      const isShopify = new URLSearchParams(window.location.search).get(\"shopify\") === \"1\";\r\n      const designId =\r\n        (typeof data.id === \"string\" && data.id) ||\r\n        (finalUrl.split(\"/\").pop() ?? String(Date.now()));\r\n\r\n      if (isShopify && window.parent && window.parent !== window) {\r\n        window.parent.postMessage(\r\n          { type: \"FM_DESIGN_READY\", designUrl: finalUrl, designId },\r\n          \"*\"\r\n        );\r\n        console.log(\"[FM] sent FM_DESIGN_READY\", { finalUrl, designId });\r\n      }\r\n    } else if (data.b64) {\r\n      // fallback: base64 preview (tohle do Shopify overlay nedávej, proto neposíláme postMessage)\r\n      setImgSrc(`data:${data.mime || \"image/png\"};base64,${data.b64}`);\r\n    } else {\r\n      throw new Error(\"No image returned\");\r\n    }\r\n\r\n    // 2) simulace objednávky = uložit draft do localStorage\r\n    const draftOrder: DraftOrder = {\r\n      draftOrderId: makeDraftId(),\r\n      createdAt: Date.now(),\r\n      style,\r\n      originalFileName: file.name,\r\n      generatedImageUrl: finalUrl || \"\",\r\n      generatedImageId: data.id,\r\n    };\r\n\r\n    localStorage.setItem(\"fm_draft_order\", JSON.stringify(draftOrder));\r\n    setDraft(draftOrder);\r\n  } catch (e: any) {\r\n    setError(e?.message ?? String(e));\r\n  } finally {\r\n    setLoading(false);\r\n  }\r\n}\r\n\r\n\r\n  function loadDraft() {\r\n    setError(null);\r\n    try {\r\n      const raw = localStorage.getItem(\"fm_draft_order\");\r\n      if (!raw) {\r\n        setDraft(null);\r\n        setSavedUrl(null);\r\n        return;\r\n      }\r\n      const parsed = JSON.parse(raw) as DraftOrder;\r\n      setDraft(parsed);\r\n      setSavedUrl(parsed.generatedImageUrl || null);\r\n    } catch (e: any) {\r\n      setError(e?.message ?? String(e));\r\n    }\r\n  }\r\n\r\n  function clearDraft() {\r\n    localStorage.removeItem(\"fm_draft_order\");\r\n    setDraft(null);\r\n    setSavedUrl(null);\r\n  }\r\n\r\n  return (\r\n    <main style={{ padding: 24, fontFamily: \"system-ui, sans-serif\" }}>\r\n      <h1 style={{ fontSize: 24, fontWeight: 700 }}>FM Proto – photo → style</h1>\r\n\r\n      <div style={{ marginTop: 16, display: \"flex\", gap: 16, alignItems: \"center\", flexWrap: \"wrap\" }}>\r\n        <input\r\n          type=\"file\"\r\n          accept=\"image/*\"\r\n          onChange={(e) => setFile(e.target.files?.[0] ?? null)}\r\n        />\r\n\r\n        <select value={style} onChange={(e) => setStyle(e.target.value as StyleKey)}>\r\n          <option value=\"tokyo\">Tokyo Revengers</option>\r\n          <option value=\"anime\">Anime</option>\r\n          <option value=\"simpsons\">Simpsons</option>\r\n          <option value=\"pixar\">3D film look</option>\r\n          <option value=\"gta\">GTA (Rockstar poster)</option>\r\n\r\n        </select>\r\n\r\n        <div style={{ marginTop: 12 }}>\r\n          <div style={{ marginBottom: 6, opacity: 0.8 }}>Custom prompt (volitelné):</div>\r\n          <input\r\n            value={customPrompt}\r\n            onChange={(e) => setCustomPrompt(e.target.value)}\r\n            placeholder='např. \"make background neon city, add subtle grain\"'\r\n            style={{ width: \"100%\", maxWidth: 640, padding: 10 }}\r\n          />\r\n        </div>\r\n\r\n\r\n        <button onClick={generate} disabled={loading} style={{ padding: \"10px 14px\" }}>\r\n          {loading ? \"Generating...\" : \"Generate\"}\r\n        </button>\r\n\r\n        <button onClick={loadDraft} style={{ padding: \"10px 14px\" }}>\r\n          Load saved draft\r\n        </button>\r\n\r\n        <button onClick={clearDraft} style={{ padding: \"10px 14px\" }}>\r\n          Clear draft\r\n        </button>\r\n      </div>\r\n\r\n      {previewUrl && (\r\n        <div style={{ marginTop: 16 }}>\r\n          <div style={{ marginBottom: 8, opacity: 0.8 }}>Original preview:</div>\r\n          <img src={previewUrl} alt=\"Original\" style={{ width: 256, borderRadius: 10 }} />\r\n        </div>\r\n      )}\r\n\r\n      {error && <p style={{ color: \"red\", marginTop: 12 }}>{error}</p>}\r\n\r\n      {imgSrc && (\r\n        <div style={{ marginTop: 16 }}>\r\n          <div style={{ marginBottom: 8, opacity: 0.8 }}>Generated:</div>\r\n          <img src={imgSrc} alt=\"Generated\" style={{ width: 512, borderRadius: 10 }} />\r\n        </div>\r\n      )}\r\n\r\n      {(draft || savedUrl) && (\r\n        <div style={{ marginTop: 20, padding: 12, border: \"1px solid #333\", borderRadius: 10 }}>\r\n          <div style={{ fontWeight: 700, marginBottom: 8 }}>Order draft (simulace)</div>\r\n\r\n          {draft ? (\r\n            <>\r\n              <div><b>draftOrderId:</b> {draft.draftOrderId}</div>\r\n              <div><b>style:</b> {draft.style}</div>\r\n              <div><b>originalFileName:</b> {draft.originalFileName}</div>\r\n              <div><b>generatedImageId:</b> {draft.generatedImageId ?? \"-\"}</div>\r\n              <div style={{ marginTop: 8 }}>\r\n                <b>generatedImageUrl:</b>{\" \"}\r\n                <a href={draft.generatedImageUrl} target=\"_blank\" rel=\"noreferrer\">\r\n                  {draft.generatedImageUrl}\r\n                </a>\r\n              </div>\r\n            </>\r\n          ) : (\r\n            <div style={{ opacity: 0.8 }}>\r\n              Draft není v paměti komponenty, ale URL je uložená:{\" \"}\r\n              <a href={savedUrl ?? \"\"} target=\"_blank\" rel=\"noreferrer\">\r\n                {savedUrl}\r\n              </a>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </main>\r\n  );\r\n}\r\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","vendored","ReactJsxRuntime","React"],"mappings":"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","ignoreList":[0,1,2]}