module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},50227,(e,t,r)=>{t.exports=e.x("node:path",()=>require("node:path"))},874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},81111,(e,t,r)=>{t.exports=e.x("node:stream",()=>require("node:stream"))},24836,(e,t,r)=>{t.exports=e.x("https",()=>require("https"))},46786,(e,t,r)=>{t.exports=e.x("os",()=>require("os"))},21517,(e,t,r)=>{t.exports=e.x("http",()=>require("http"))},4446,(e,t,r)=>{t.exports=e.x("net",()=>require("net"))},55004,(e,t,r)=>{t.exports=e.x("tls",()=>require("tls"))},92509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},12714,(e,t,r)=>{t.exports=e.x("node:fs/promises",()=>require("node:fs/promises"))},66680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},64648,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(59756),i=e.i(61916),s=e.i(74677),o=e.i(69741),l=e.i(16795),u=e.i(87718),d=e.i(95169),p=e.i(47587),c=e.i(66012),m=e.i(70101),h=e.i(26937),g=e.i(10372),x=e.i(93695);e.i(52474);var f=e.i(220),v=e.i(34731),R=e.i(12714),y=e.i(50227),w=e.i(66680);async function E(e){try{let t=process.env.GEMINI_API_KEY;if(!t)return Response.json({error:"Missing GEMINI_API_KEY"},{status:500});let r=await e.formData(),a=String(r.get("style")||"anime"),n=r.get("file");if(!n)return Response.json({error:"Missing file"},{status:400});let i=Buffer.from(await n.arrayBuffer()),s=n.type||"image/png",o=i.toString("base64"),l=String(r.get("customPrompt")||"").trim(),u={simpsons:"Simpsons-style cartoon portrait, flat colors, thick outlines.",anime:"Anime portrait, clean lineart, vibrant colors.",tokyo:"Tokyo Revengers-style anime portrait, dramatic lighting.",pixar:"3D animated film look, soft lighting, detailed shading.",gta:"Rockstar Games / GTA V official key art illustration style (NOT anime). Clean vector-like ink lines, sharp edges, cel-shaded painting, high contrast. Cinematic warm sunset lighting, vibrant Miami/Vice City palette. Poster composition, dramatic but realistic proportions (no big anime eyes). Face and identity must match the original photo exactly. NO text, NO logos, NO game UI, NO watermarks, NO captions. Background: simplified city street with palm trees and art-deco buildings OR simple gradient if uncertain."},d=`Transform the person in the input photo into this style: ${u[a]||u.anime}. Keep the same identity, face features, hairstyle and pose. Do not change clothing unless requested. Output: a single image only. Hard rules: NO text, NO UI/HUD, NO borders, NO watermarks, NO logos. `+(l?`Additional instructions: ${l}`:""),p=new v.GoogleGenAI({apiKey:t}),c=await p.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{text:d},{inlineData:{mimeType:s,data:o}}]}}),m=(c?.candidates?.[0]?.content?.parts??[]).find(e=>e?.inlineData?.data);if(!m)return Response.json({error:"No image returned"},{status:500});let h=m.inlineData.mimeType??"image/png",g=m.inlineData.data,x=h.includes("png")?"png":h.includes("jpeg")||h.includes("jpg")?"jpg":"png",f=w.default.randomUUID(),E=`${f}.${x}`,b=y.default.join(process.cwd(),"public","uploads");await R.default.mkdir(b,{recursive:!0});let C=y.default.join(b,E);await R.default.writeFile(C,Buffer.from(g,"base64"));let _=`/uploads/${E}`;return Response.json({id:f,url:_,mime:h,b64:g,style:a})}catch(e){return Response.json({error:e?.message??String(e)},{status:500})}}e.s(["POST",()=>E],58274);var b=e.i(58274);let C=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/transform-gemini/route",pathname:"/api/transform-gemini",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/transform-gemini/route.ts",nextConfigOutput:"",userland:b}),{workAsyncStorage:_,workUnitAsyncStorage:N,serverHooks:k}=C;function A(){return(0,a.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:N})}async function O(e,t,a){C.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/transform-gemini/route";v=v.replace(/\/index$/,"")||"/";let R=await C.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:y,params:w,nextConfig:E,parsedUrl:b,isDraftMode:_,prerenderManifest:N,routerServerContext:k,isOnDemandRevalidate:A,revalidateOnlyGenerated:O,resolvedPathname:q,clientReferenceManifest:P,serverActionsManifest:T}=R,j=(0,o.normalizeAppPath)(v),I=!!(N.dynamicRoutes[j]||N.routes[q]),S=async()=>((null==k?void 0:k.render404)?await k.render404(e,t,b,!1):t.end("This page could not be found"),null);if(I&&!_){let e=!!N.routes[q],t=N.dynamicRoutes[j];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await S();throw new x.NoFallbackError}}let D=null;!I||C.isDev||_||(D="/index"===(D=q)?"/":D);let U=!0===C.isDev||!I,H=I&&!U;T&&P&&(0,s.setManifestsSingleton)({page:v,clientReferenceManifest:P,serverActionsManifest:T});let M=e.method||"GET",$=(0,i.getTracer)(),K=$.getActiveScopeSpan(),F={params:w,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,n)=>C.onRequestError(e,t,a,n,k)},sharedContext:{buildId:y}},B=new l.NodeNextRequest(e),G=new l.NodeNextResponse(t),L=u.NextRequestAdapter.fromNodeNextRequest(B,(0,u.signalFromNodeResponse)(t));try{let s=async e=>C.handle(L,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=$.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${M} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${v}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var i,l;let u=async({previousCacheEntry:r})=>{try{if(!o&&A&&O&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await s(n);e.fetchMetrics=F.renderOpts.fetchMetrics;let l=F.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let u=F.renderOpts.collectedTags;if(!I)return await (0,c.sendResponse)(B,G,i,F.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(i.headers);u&&(t[g.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,a=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:A})},!1,k),t}},d=await C.handleResponse({req:e,nextConfig:E,cacheKey:D,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:O,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:o});if(!I)return null;if((null==d||null==(i=d.value)?void 0:i.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",A?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),_&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let x=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&I||x.delete(g.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||x.get("Cache-Control")||x.set("Cache-Control",(0,h.getCacheControlHeader)(d.cacheControl)),await (0,c.sendResponse)(B,G,new Response(d.value.body,{headers:x,status:d.value.status||200})),null};K?await l(K):await $.withPropagatedContext(e.headers,()=>$.trace(d.BaseServerSpan.handleRequest,{spanName:`${M} ${v}`,kind:i.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},l))}catch(t){if(t instanceof x.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:A})},!1,k),I)throw t;return await (0,c.sendResponse)(B,G,new Response(null,{status:500})),null}}e.s(["handler",()=>O,"patchFetch",()=>A,"routeModule",()=>C,"serverHooks",()=>k,"workAsyncStorage",()=>_,"workUnitAsyncStorage",()=>N],64648)},85685,e=>{e.v(e=>Promise.resolve().then(()=>e(54799)))},91961,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__c130a00c._.js"].map(t=>e.l(t))).then(()=>t(12111)))},72331,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_node-fetch_src_utils_multipart-parser_b4f48f6f.js","server/chunks/[root-of-the-server]__bc5b3c96._.js","server/chunks/[root-of-the-server]__e24658a7._.js"].map(t=>e.l(t))).then(()=>t(20442)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__3be8da8e._.js.map